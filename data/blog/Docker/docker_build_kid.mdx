---
title: 'Docker BuildKit'
tags: [Docker]
date: 2025-12-18
---

**BuildKit** is Dockerâ€™s **modern build engine** â€” itâ€™s the part of Docker that actually _builds images_, and it replaces the old, slower â€œlegacy builderâ€.

Think of it as:

> **â€œDocker build, but faster, smarter, and more powerful.â€**

---

## What BuildKit does (in plain terms)

BuildKit improves **how Docker builds images**:

- ğŸš€ **Much faster builds**
- ğŸ§  **Smarter caching**
- ğŸ”’ **Secure handling of secrets**
- ğŸ§© **More advanced Dockerfile features**
- ğŸ” **Parallel execution**

The legacy builder could only do things **step by step**.
BuildKit analyzes the Dockerfile and builds **what it can in parallel**.

---

## Features you only get with BuildKit

### 1ï¸âƒ£ `RUN --mount` (what you just saw)

```dockerfile
RUN --mount=type=cache,target=/root/.cache \
    pip install -r requirements.txt
```

- Caches dependencies between builds
- No cache baked into the final image

---

### 2ï¸âƒ£ Secrets without leaking them

```dockerfile
RUN --mount=type=secret,id=npmrc \
    npm install
```

- Secrets never end up in image layers
- Much safer than `ARG` or `ENV`

Build command:

```bash
docker build --secret id=npmrc,src=$HOME/.npmrc .
```

---

### 3ï¸âƒ£ Better caching (huge speed boost)

BuildKit:

- Caches individual commands
- Reuses cache more accurately
- Avoids invalidating unrelated layers

Result: **small changes donâ€™t rebuild everything**

---

### 4ï¸âƒ£ Parallel build steps

Example:

```dockerfile
FROM node:20 AS frontend
# build frontend

FROM python:3.12 AS backend
# build backend
```

BuildKit builds these **at the same time**.

---

### 5ï¸âƒ£ Cleaner multi-stage builds

BuildKit understands dependencies between stages and skips unnecessary work.

---

## Is BuildKit enabled by default?

### Docker Desktop (Mac / Windows)

âœ… **Yes**, enabled by default

### Linux

Usually **yes**, but can be forced:

```bash
export DOCKER_BUILDKIT=1
```

Or permanently:

```bash
~/.docker/config.json
{
  "features": {
    "buildkit": true
  }
}
```

---

## How to tell if youâ€™re using BuildKit

Youâ€™ll see output like:

```
# syntax=docker/dockerfile:1
 => [internal] load build definition from Dockerfile
```

Or this error (classic sign):

```
--mount is not allowed in legacy builder
```

---

## Legacy builder vs BuildKit (quick table)

| Feature         | Legacy | BuildKit |
| --------------- | ------ | -------- |
| Parallel builds | âŒ     | âœ…       |
| `RUN --mount`   | âŒ     | âœ…       |
| Secrets         | âŒ     | âœ…       |
| Better cache    | âŒ     | âœ…       |
| Faster          | âŒ     | âœ…       |

---

## When should you care?

You **should care** if you:

- Build images often
- Use CI/CD
- Want faster builds
- Need secrets during build
- Use modern Dockerfiles

Which isâ€¦ basically **everyone now** ğŸ˜„
